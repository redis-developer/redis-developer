"use strict";(self.webpackChunkredis_developer_hub=self.webpackChunkredis_developer_hub||[]).push([[3414,4074,27,9494],{3905:(e,t,o)=>{o.d(t,{Zo:()=>l,kt:()=>m});var n=o(67294);function i(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function r(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function a(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?r(Object(o),!0).forEach((function(t){i(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function s(e,t){if(null==e)return{};var o,n,i=function(e,t){if(null==e)return{};var o,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)o=r[n],t.indexOf(o)>=0||(i[o]=e[o]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)o=r[n],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(i[o]=e[o])}return i}var c=n.createContext({}),d=function(e){var t=n.useContext(c),o=t;return e&&(o="function"==typeof e?e(t):a(a({},t),e)),o},l=function(e){var t=d(e.components);return n.createElement(c.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var o=e.components,i=e.mdxType,r=e.originalType,c=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),u=d(o),m=i,h=u["".concat(c,".").concat(m)]||u[m]||p[m]||r;return o?n.createElement(h,a(a({ref:t},l),{},{components:o})):n.createElement(h,a({ref:t},l))}));function m(e,t){var o=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=o.length,a=new Array(r);a[0]=u;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:i,a[1]=s;for(var d=2;d<r;d++)a[d]=o[d];return n.createElement.apply(null,a)}return n.createElement.apply(null,o)}u.displayName="MDXCreateElement"},50358:(e,t,o)=>{o.d(t,{Z:()=>c});var n=o(67294),i=o(52263);const r="authorByline_VoxI",a="authorLabel_a70t",s="authorProfileImage_URwT";const c=function(e){let{frontMatter:t}=e;const{siteConfig:o}=(0,i.Z)(),c=o.customFields.authors;return n.createElement(n.Fragment,null,t.authors&&n.createElement("div",{className:"docAuthors"},n.createElement("hr",null),t.authors.map((e=>n.createElement("div",{key:e,className:r},n.createElement("img",{className:s,src:`/img/${c[e].image?c[e].image:"default_author_profile_pic.png"}`,alt:`Profile picture for ${c[e].name}`}),n.createElement("div",null,n.createElement("div",{className:a},"Author:"),n.createElement("div",null,n.createElement("a",{href:c[e].link,target:"_blank"},c[e].name),", ",c[e].title))))),n.createElement("hr",null)))}},70895:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>p,frontMatter:()=>r,metadata:()=>s,toc:()=>d});var n=o(87462),i=(o(67294),o(3905));const r={},a=void 0,s={unversionedId:"howtos/solutions/geo/common-geo/microservices-ecommerce-geo",id:"howtos/solutions/geo/common-geo/microservices-ecommerce-geo",title:"microservices-ecommerce-geo",description:"The e-commerce microservices application consists of a frontend, built using Next.js with TailwindCSS. The application backend uses Node.js. The data is stored in Redis and either MongoDB or PostgreSQL, using Prisma. Below are screenshots showcasing the frontend of the e-commerce app.",source:"@site/docs/howtos/solutions/geo/common-geo/microservices-ecommerce-geo.mdx",sourceDirName:"howtos/solutions/geo/common-geo",slug:"/howtos/solutions/geo/common-geo/microservices-ecommerce-geo",permalink:"/howtos/solutions/geo/common-geo/microservices-ecommerce-geo",draft:!1,editUrl:"https://github.com/redis-developer/redis-developer/edit/master/docs/howtos/solutions/geo/common-geo/microservices-ecommerce-geo.mdx",tags:[],version:"current",lastUpdatedAt:1707940544,formattedLastUpdatedAt:"Feb 14, 2024",frontMatter:{}},c={},d=[],l={toc:d};function p(e){let{components:t,...r}=e;return(0,i.kt)("wrapper",(0,n.Z)({},l,r,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"The e-commerce microservices application consists of a frontend, built using ",(0,i.kt)("a",{parentName:"p",href:"https://nextjs.org/"},"Next.js")," with ",(0,i.kt)("a",{parentName:"p",href:"https://tailwindcss.com/"},"TailwindCSS"),". The application backend uses ",(0,i.kt)("a",{parentName:"p",href:"https://nodejs.org"},"Node.js"),". The data is stored in ",(0,i.kt)("a",{parentName:"p",href:"https://redis.com/try-free/"},"Redis")," and either MongoDB or PostgreSQL, using ",(0,i.kt)("a",{parentName:"p",href:"https://www.prisma.io/docs/reference/database-reference/supported-databases"},"Prisma"),". Below are screenshots showcasing the frontend of the e-commerce app."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Dashboard:")," Displays a list of products with different search functionalities, configurable in the settings page.\n",(0,i.kt)("img",{alt:"Redis Microservices E-commerce App Frontend - Products Page",src:o(4746).Z,width:"1920",height:"914"})),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Settings:")," Accessible by clicking the gear icon at the top right of the dashboard. Control the search bar, chatbot visibility, and other features here.\n",(0,i.kt)("img",{alt:"Redis Microservices E-commerce App Frontend - Settings Page",src:o(34514).Z,width:"1564",height:"1056"})),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Dashboard (Geo Location Search):")," Configured for ",(0,i.kt)("inlineCode",{parentName:"p"},"Geo location search"),", the search bar enables location queries. ",(0,i.kt)("br",null),"\n",(0,i.kt)("em",{parentName:"p"},"Note:")," In our demo, each zipCode location is mapped with lat long coordinates.\n",(0,i.kt)("img",{alt:"Redis Microservices E-commerce App Frontend - Semantic Text Search",src:o(93959).Z,width:"1920",height:"906"})),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Shopping Cart:"),' Add products to the cart and check out using the "Buy Now" button.\n',(0,i.kt)("img",{alt:"Redis Microservices E-commerce App Frontend - Shopping Cart",src:o(6424).Z,width:"1920",height:"906"})),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Order History:")," Post-purchase, the 'Orders' link in the top navigation bar shows the order status and history.\n",(0,i.kt)("img",{alt:"Redis Microservices E-commerce App Frontend - Order History Page",src:o(21494).Z,width:"1920",height:"673"})),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Admin Panel:")," Accessible via the 'admin' link in the top navigation. Displays purchase statistics and trending products.\n",(0,i.kt)("img",{alt:"Redis Microservices E-commerce App Frontend - Admin Page",src:o(33643).Z,width:"2604",height:"1230"}),"\n",(0,i.kt)("img",{alt:"Redis Microservices E-commerce App Frontend - Admin Page",src:o(34959).Z,width:"1920",height:"632"})))}p.isMDXComponent=!0},68131:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>p,frontMatter:()=>r,metadata:()=>s,toc:()=>d});var n=o(87462),i=(o(67294),o(3905));const r={},a=void 0,s={unversionedId:"howtos/solutions/geo/common-geo/microservices-source-code-geo",id:"howtos/solutions/geo/common-geo/microservices-source-code-geo",title:"microservices-source-code-geo",description:"Below is a command to the clone the source code for the application used in this tutorial",source:"@site/docs/howtos/solutions/geo/common-geo/microservices-source-code-geo.mdx",sourceDirName:"howtos/solutions/geo/common-geo",slug:"/howtos/solutions/geo/common-geo/microservices-source-code-geo",permalink:"/howtos/solutions/geo/common-geo/microservices-source-code-geo",draft:!1,editUrl:"https://github.com/redis-developer/redis-developer/edit/master/docs/howtos/solutions/geo/common-geo/microservices-source-code-geo.mdx",tags:[],version:"current",lastUpdatedAt:1707940544,formattedLastUpdatedAt:"Feb 14, 2024",frontMatter:{}},c={},d=[],l={toc:d};function p(e){let{components:t,...o}=e;return(0,i.kt)("wrapper",(0,n.Z)({},l,o,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("admonition",{title:"GITHUB CODE",type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"Below is a command to the clone the source code for the application used in this tutorial"),(0,i.kt)("p",{parentName:"admonition"},"git clone --branch v10.1.0 ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/redis-developer/redis-microservices-ecommerce-solutions"},"https://github.com/redis-developer/redis-microservices-ecommerce-solutions"))))}p.isMDXComponent=!0},45224:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>u,contentTitle:()=>l,default:()=>g,frontMatter:()=>d,metadata:()=>p,toc:()=>m});var n=o(87462),i=(o(67294),o(3905)),r=o(50358),a=o(36773),s=o(70895),c=o(68131);const d={id:"index-geo-search",title:"Getting Started With Geo Location Search in Redis",sidebar_label:"Getting Started With Geo Location Search in Redis",slug:"/howtos/solutions/geo/getting-started",authors:["prasan","will"]},l=void 0,p={unversionedId:"howtos/solutions/geo/getting-started-geo/index-geo-search",id:"howtos/solutions/geo/getting-started-geo/index-geo-search",title:"Getting Started With Geo Location Search in Redis",description:"What you will learn in this tutorial",source:"@site/docs/howtos/solutions/geo/getting-started-geo/index-geo-search.mdx",sourceDirName:"howtos/solutions/geo/getting-started-geo",slug:"/howtos/solutions/geo/getting-started",permalink:"/howtos/solutions/geo/getting-started",draft:!1,editUrl:"https://github.com/redis-developer/redis-developer/edit/master/docs/howtos/solutions/geo/getting-started-geo/index-geo-search.mdx",tags:[],version:"current",lastUpdatedAt:1707940544,formattedLastUpdatedAt:"Feb 14, 2024",frontMatter:{id:"index-geo-search",title:"Getting Started With Geo Location Search in Redis",sidebar_label:"Getting Started With Geo Location Search in Redis",slug:"/howtos/solutions/geo/getting-started",authors:["prasan","will"]},sidebar:"docs",previous:{title:"Getting Started With Triggers and Functions in Redis",permalink:"/howtos/solutions/triggers-and-functions/getting-started"},next:{title:"How to build a Real-Time Leaderboard app Using Redis",permalink:"/howtos/leaderboard"}},u={},m=[{value:"What you will learn in this tutorial",id:"what-you-will-learn-in-this-tutorial",level:2},{value:"Microservices architecture for an e-commerce application",id:"microservices-architecture-for-an-e-commerce-application",level:2},{value:"E-commerce application frontend using Next.js and Tailwind",id:"e-commerce-application-frontend-using-nextjs-and-tailwind",level:2},{value:"What is Geo Location search?",id:"what-is-geo-location-search",level:2},{value:"Why you should use Redis for Geo Location search?",id:"why-you-should-use-redis-for-geo-location-search",level:2},{value:"Database setup",id:"database-setup",level:2},{value:"Collection details",id:"collection-details",level:3},{value:"Indexing data",id:"indexing-data",level:3},{value:"Building Geo Location search with Redis",id:"building-geo-location-search-with-redis",level:2},{value:"Sample raw query",id:"sample-raw-query",level:3},{value:"API endpoint",id:"api-endpoint",level:3},{value:"API implementation",id:"api-implementation",level:3},{value:"Front end",id:"front-end",level:3},{value:"Ready to use Redis for Geo Location search?",id:"ready-to-use-redis-for-geo-location-search",level:2},{value:"References",id:"references",level:3}],h={toc:m};function g(e){let{components:t,...l}=e;return(0,i.kt)("wrapper",(0,n.Z)({},h,l,{components:t,mdxType:"MDXLayout"}),(0,i.kt)(r.Z,{frontMatter:d,mdxType:"Authors"}),(0,i.kt)("h2",{id:"what-you-will-learn-in-this-tutorial"},"What you will learn in this tutorial"),(0,i.kt)("p",null,"In this comprehensive tutorial, you will gain practical knowledge and hands-on experience with Geo Location search capabilities using Redis, particularly focusing on its application within a microservices architecture for an e-commerce platform. Here's what you can expect to learn:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Integrating Geo Location Search with Redis"),": Dive deep into the concept of Geo Location search, exploring how Redis can be leveraged to implement real-time location-based search functionalities such as proximity searches, geo-spatial queries, and location-based filtering.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Database Setup and Indexing with Redis"),": Learn the steps for setting up your Redis database to support Geo Location search, including how to structure your data collections and index them effectively for fast and efficient querying.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Building and Querying Geo-Spatial Data"),": Gain hands-on experience with writing and executing raw Redis queries for geo-spatial data, understanding the syntax and options available for searching within a radius, calculating distances, and sorting results based on geographical proximity.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Developing an API Endpoint for Geo Location Search"),": Walk through the process of building a RESTful API endpoint that leverages Redis to perform Geo Location searches, demonstrating how to integrate this functionality into a Node.js backend."))),(0,i.kt)("h2",{id:"microservices-architecture-for-an-e-commerce-application"},"Microservices architecture for an e-commerce application"),(0,i.kt)(c.default,{mdxType:"SourceCode"}),(0,i.kt)(a.default,{mdxType:"InitialMicroservicesArchitecture"}),(0,i.kt)("h2",{id:"e-commerce-application-frontend-using-nextjs-and-tailwind"},"E-commerce application frontend using Next.js and Tailwind"),(0,i.kt)(s.default,{mdxType:"MicroservicesEcommerceGeoDesign"}),(0,i.kt)("h2",{id:"what-is-geo-location-search"},"What is Geo Location search?"),(0,i.kt)("p",null,"Geo Location search involves querying and processing data based on geographical locations identified by latitude and longitude coordinates. This capability is crucial for a wide range of applications, including location-based services, proximity searches, and spatial analysis."),(0,i.kt)("p",null,"It allows systems to store, index, and quickly retrieve data points within geographical contexts, such as finding all users within a certain distance from a specific point, or calculating the distance between two locations ..etc."),(0,i.kt)("h2",{id:"why-you-should-use-redis-for-geo-location-search"},"Why you should use Redis for Geo Location search?"),(0,i.kt)("p",null,"Redis's ",(0,i.kt)("strong",{parentName:"p"},"geo-spatial")," capabilities enable developers to build location-aware applications that can perform proximity searches, location-based filtering, and spatial analysis with ease."),(0,i.kt)("p",null,"Redis's ",(0,i.kt)("strong",{parentName:"p"},"in-memory")," architecture ensures that geo-spatial data is stored and processed in memory,\nresulting in ",(0,i.kt)("strong",{parentName:"p"},"low latency")," and high throughput for location-based queries. This makes Redis an ideal choice for applications requiring ",(0,i.kt)("strong",{parentName:"p"},"real-time")," location-based search functionalities."),(0,i.kt)("p",null,"Consider a multi store shopping scenario where consumers locate a product online, place the order in their browser or mobile device, and pick up at nearest store location. This is called \u201cbuy-online-pickup-in-store\u201d (BOPIS). Redis enables a ",(0,i.kt)("strong",{parentName:"p"},"real-time view")," of store inventory and and seamless BOPIS shopping experience."),(0,i.kt)("h2",{id:"database-setup"},"Database setup"),(0,i.kt)(c.default,{mdxType:"SourceCode"}),(0,i.kt)("h3",{id:"collection-details"},"Collection details"),(0,i.kt)("p",null,"Our demo application which utilizes two primary data collections within Redis to simulate an e-commerce platform's inventory system:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"products")," collection : This collection stores detailed information about each product, including name, description, category and price.")),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"collection-products",src:o(67941).Z,width:"1920",height:"1185"})),(0,i.kt)("admonition",{type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"Utilize ",(0,i.kt)("u",null,(0,i.kt)("a",{parentName:"p",href:"https://redis.com/redis-enterprise/redis-insight/"},"RedisInsight"))," to interactively explore your Redis database and execute raw Redis commands in a user-friendly workbench environment.")),(0,i.kt)("ol",{start:2},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"storeInventory")," collection : This collection maintains the inventory status of products across different store locations. It records the quantity of each product available at various stores, facilitating inventory tracking and management.")),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"collection-store-inventory",src:o(94986).Z,width:"1920",height:"1192"})),(0,i.kt)("p",null,"For the purpose of this demo, we simulate an e-commerce operation in various regions across New York (US), with each store location identified by a ",(0,i.kt)("inlineCode",{parentName:"p"},"storeId")," and associated ",(0,i.kt)("inlineCode",{parentName:"p"},"stockQty")," for products."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"new-york-state",src:o(59362).Z,width:"1272",height:"998"})),(0,i.kt)("h3",{id:"indexing-data"},"Indexing data"),(0,i.kt)("p",null,"To enable Geo Location searches within our storeInventory collection, it's crucial to index the data appropriately. Redis offers multiple methods for creating indexes: using the Command Line Interface (CLI) or using client libraries like Redis OM, node redis .. etc."),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Using CLI command")),(0,i.kt)("p",null,"To facilitate geo-spatial queries and other search operations on the ",(0,i.kt)("inlineCode",{parentName:"p"},"storeInventory")," collection, follow these commands:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},'# Remove existing index\nFT.DROPINDEX "storeInventory:storeInventoryId:index"\n\n# Create a new index with geo-spatial and other field capabilities\nFT.CREATE "storeInventory:storeInventoryId:index"\n  ON JSON\n  PREFIX 1 "storeInventory:storeInventoryId:"\n  SCHEMA\n    "$.storeId" AS "storeId" TAG SEPARATOR "|"\n    "$.storeName" AS "storeName" TEXT\n    "$.storeLocation" AS "storeLocation" GEO\n    "$.productId" AS "productId" TAG SEPARATOR "|"\n    "$.productDisplayName" AS "productDisplayName" TEXT\n    "$.stockQty" AS "stockQty" NUMERIC\n    "$.statusCode" AS "statusCode" NUMERIC\n')),(0,i.kt)("ol",{start:2},(0,i.kt)("li",{parentName:"ol"},"Using Redis OM")),(0,i.kt)("p",null,"For applications leveraging the Node.js environment, Redis OM provides an elegant, object-mapping approach to interact with Redis. Below is an implementation example to set up the index using Redis OM:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="server/src/common/models/store-inventory-repo.ts"',title:'"server/src/common/models/store-inventory-repo.ts"'},"// Import necessary Redis OM classes\nimport {\n  Schema as RedisSchema,\n  Repository as RedisRepository,\n  EntityId as RedisEntityId,\n} from 'redis-om';\n\nimport { getNodeRedisClient } from '../utils/redis/redis-wrapper';\n\n// Define a prefix for store inventory keys and the schema for indexing\nconst STORE_INVENTORY_KEY_PREFIX = 'storeInventory:storeInventoryId';\nconst schema = new RedisSchema(STORE_INVENTORY_KEY_PREFIX, {\n  storeId: { type: 'string', indexed: true },\n  storeName: { type: 'text', indexed: true },\n  storeLocation: { type: 'point', indexed: true }, // Uses longitude,latitude format\n\n  productId: { type: 'string', indexed: true },\n  productDisplayName: { type: 'text', indexed: true },\n  stockQty: { type: 'number', indexed: true },\n  statusCode: { type: 'number', indexed: true },\n});\n\n/*\n A Repository is the main interface into Redis OM. It gives us the methods to read, write, and remove a specific Entity\n */\nconst getRepository = () => {\n  const redisClient = getNodeRedisClient();\n  const repository = new RedisRepository(schema, redisClient);\n  return repository;\n};\n\n/*\nwe need to create an index or we won't be able to search.\nRedis OM uses hash to see if index needs to be recreated or not\n*/\nconst createRedisIndex = async () => {\n  const repository = getRepository();\n  await repository.createIndex();\n};\n\nexport {\n  getRepository,\n  createRedisIndex,\n  RedisEntityId,\n  STORE_INVENTORY_KEY_PREFIX,\n};\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="server/src/services/products/src/index.ts"',title:'"server/src/services/products/src/index.ts"'},"import * as StoreInventoryRepo from '../../../common/models/store-inventory-repo';\n\napp.listen(PORT, async () => {\n  //...\n\n  // Create index for store inventory on startup\n  await StoreInventoryRepo.createRedisIndex();\n  //...\n});\n")),(0,i.kt)("h2",{id:"building-geo-location-search-with-redis"},"Building Geo Location search with Redis"),(0,i.kt)("h3",{id:"sample-raw-query"},"Sample raw query"),(0,i.kt)("p",null,"Once the data is indexed, you can execute raw Redis queries to perform Geo Location searches and other spatial operations. Here are two sample queries to demonstrate the capabilities:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("strong",{parentName:"li"},"Searching Products Within a Radius"),": This sample query demonstrates how to find products within a ",(0,i.kt)("inlineCode",{parentName:"li"},"50-mile")," radius of a specific location (",(0,i.kt)("inlineCode",{parentName:"li"},"New York City"),") with a particular product name (",(0,i.kt)("inlineCode",{parentName:"li"},"puma"),"). It combines geo-spatial search capabilities with text search to filter results based on both location and product name.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},'FT.SEARCH "storeInventory:storeInventoryId:index" "( ( ( (@statusCode:[1 1]) (@stockQty:[(0 +inf]) ) (@storeLocation:[-73.968285 40.785091 50 mi]) ) (@productDisplayName:\'puma\') )"\n')),(0,i.kt)("p",null,"This query leverages the ",(0,i.kt)("inlineCode",{parentName:"p"},"FT.SEARCH")," command to perform a search within the ",(0,i.kt)("inlineCode",{parentName:"p"},"storeInventory:storeInventoryId:index"),". It specifies a circular area defined by the center's longitude and latitude and a radius of ",(0,i.kt)("inlineCode",{parentName:"p"},"50 miles"),". Additionally, it filters products by availability ",(0,i.kt)("inlineCode",{parentName:"p"},"(@stockQty:[(0 +inf]))")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"@statusCode")," indicating an active status ",(0,i.kt)("inlineCode",{parentName:"p"},"([1 1])"),", combined with a match on the product display name containing ",(0,i.kt)("inlineCode",{parentName:"p"},"puma"),"."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"geo-query-1",src:o(92078).Z,width:"1920",height:"1189"})),(0,i.kt)("ol",{start:2},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("strong",{parentName:"li"},"Aggregate Query for Sorted Results"),": This aggregate query extends the first example by sorting the results based on the geographical distance from the search location and limiting the results to the first 100.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},'FT.AGGREGATE "storeInventory:storeInventoryId:index"\n          "( ( ( (@statusCode:[1 1]) (@stockQty:[(0 +inf]) ) (@storeLocation:[-73.968285 40.785091 50 mi]) ) (@productDisplayName:\'puma\') )"\n          LOAD 6 "@storeId" "@storeName" "@storeLocation" "@productId" "@productDisplayName" "@stockQty"\n          APPLY "geodistance(@storeLocation, -73.968285, 40.785091)/1609"\n          AS "distInMiles"\n          SORTBY 1 "@distInMiles"\n          LIMIT 0 100\n')),(0,i.kt)("p",null,"In this query, ",(0,i.kt)("inlineCode",{parentName:"p"},"FT.AGGREGATE")," is used to process and transform search results. The ",(0,i.kt)("inlineCode",{parentName:"p"},"APPLY")," clause calculates the distance between each store location and the specified coordinates, converting the result into miles. The ",(0,i.kt)("inlineCode",{parentName:"p"},"SORTBY")," clause orders the results by this distance, and ",(0,i.kt)("inlineCode",{parentName:"p"},"LIMIT")," caps the output to 100 entries, making the query highly relevant for applications requiring sorted proximity-based search results."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"geo-query-2",src:o(10835).Z,width:"1920",height:"1183"})),(0,i.kt)("h3",{id:"api-endpoint"},"API endpoint"),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"getStoreProductsByGeoFilter")," API endpoint enables clients to search for store products based on geographical location and product name, demonstrating a practical application of Redis Geo Location search capabilities."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"API Request")),(0,i.kt)("p",null,"The request payload specifies the product name to search for, the search radius in miles, and the user's current location in latitude and longitude coordinates."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'POST http://localhost:3000/products/getStoreProductsByGeoFilter\n{\n    "productDisplayName":"puma",\n\n    "searchRadiusInMiles":50,\n    "userLocation": {\n        "latitude": 40.785091,\n        "longitude": -73.968285\n    }\n}\n')),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"API Response")),(0,i.kt)("p",null,"The response returns an array of products matching the search criteria, including detailed information about each product and its distance from the user's location."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "data": [\n    {\n      "productId": "11000",\n      "price": 3995,\n      "productDisplayName": "Puma Men Slick 3HD Yellow Black Watches",\n      "variantName": "Slick 3HD Yellow",\n      "brandName": "Puma",\n      "ageGroup": "Adults-Men",\n      "gender": "Men",\n      "displayCategories": "Accessories",\n      "masterCategory_typeName": "Accessories",\n      "subCategory_typeName": "Watches",\n      "styleImages_default_imageURL": "http://host.docker.internal:8080/images/11000.jpg",\n      "productDescriptors_description_value": "...",\n\n      "stockQty": "5",\n      "storeId": "11_NY_MELVILLE",\n      "storeLocation": {\n        "longitude": -73.41512,\n        "latitude": 40.79343\n      },\n      "distInMiles": "46.59194"\n    }\n    //...\n  ],\n  "error": null\n}\n')),(0,i.kt)("h3",{id:"api-implementation"},"API implementation"),(0,i.kt)("p",null,"This section outlines the implementation of the ",(0,i.kt)("inlineCode",{parentName:"p"},"getStoreProductsByGeoFilter")," API, focusing on the ",(0,i.kt)("inlineCode",{parentName:"p"},"searchStoreInventoryByGeoFilter")," function that executes the core search logic."),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Function Overview"),": ",(0,i.kt)("inlineCode",{parentName:"p"},"searchStoreInventoryByGeoFilter")," accepts an inventory filter object that includes optional product display name, search radius in miles, and user location. It constructs a query to find store products within the specified radius that match the product name.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Query Construction"),": The function builds a search query using Redis OM's fluent API, specifying conditions for product availability, stock quantity, and proximity to the user's location. It also optionally filters products by name if specified.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Executing the Query"),": The constructed query is executed against Redis using the ft.aggregate method, which allows for complex aggregations and transformations. The query results are processed to calculate the distance in miles from the user's location and sort the results accordingly.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Result Processing"),": The function filters out duplicate products across different stores, ensuring unique product listings in the final output. It then formats the store locations into a more readable structure and compiles the final list of products to return."))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'import * as StoreInventoryRepo from \'../../../common/models/store-inventory-repo\';\n\ninterface IInventoryBodyFilter {\n  productDisplayName?: string;\n\n  searchRadiusInMiles?: number;\n  userLocation?: {\n    latitude?: number;\n    longitude?: number;\n  },\n}\n\nconst searchStoreInventoryByGeoFilter = async (\n  _inventoryFilter: IInventoryBodyFilter,\n) => {\n  // (1) ---\n  const redisClient = getNodeRedisClient();\n  const repository = StoreInventoryRepo.getRepository();\n  let storeProducts: IStoreInventory[] = [];\n  const trimmedStoreProducts: IStoreInventory[] = [] // similar item of other stores are removed\n  const uniqueProductIds = {};\n\n  if (repository\n    && _inventoryFilter?.userLocation?.latitude\n    && _inventoryFilter?.userLocation?.longitude) {\n\n    const lat = _inventoryFilter.userLocation.latitude;\n    const long = _inventoryFilter.userLocation.longitude;\n    const radiusInMiles = _inventoryFilter.searchRadiusInMiles || 500;\n\n    // (2) --- Query Construction\n    let queryBuilder = repository\n      .search()\n      .and(\'statusCode\')\n      .eq(1)\n      .and(\'stockQty\')\n      .gt(0)\n      .and(\'storeLocation\')\n      .inRadius((circle) => {\n        return circle\n          .latitude(lat)\n          .longitude(long)\n          .radius(radiusInMiles)\n          .miles\n      });\n\n    if (_inventoryFilter.productDisplayName) {\n      queryBuilder = queryBuilder\n        .and(\'productDisplayName\')\n        .matches(_inventoryFilter.productDisplayName)\n    }\n\n    console.log(queryBuilder.query);\n\n    /* Sample queryBuilder.query to run on CLI\n    FT.SEARCH "storeInventory:storeInventoryId:index" "( ( ( (@statusCode:[1 1]) (@stockQty:[(0 +inf]) ) (@storeLocation:[-73.968285 40.785091 50 mi]) ) (@productDisplayName:\'puma\') )"\n            */\n\n   // (3) --- Executing the Query\n    const indexName = `storeInventory:storeInventoryId:index`;\n    const aggregator = await redisClient.ft.aggregate(\n      indexName,\n      queryBuilder.query,\n      {\n        LOAD: ["@storeId", "@storeName", "@storeLocation", "@productId", "@productDisplayName", "@stockQty"],\n        STEPS: [{\n          type: AggregateSteps.APPLY,\n          expression: `geodistance(@storeLocation, ${long}, ${lat})/1609`,\n          AS: \'distInMiles\'\n        }, {\n          type: AggregateSteps.SORTBY,\n          BY: ["@distInMiles", "@productId"]\n        }, {\n          type: AggregateSteps.LIMIT,\n          from: 0,\n          size: 1000,\n        }]\n      });\n\n    /* Sample command to run on CLI\n        FT.AGGREGATE "storeInventory:storeInventoryId:index"\n          "( ( ( (@statusCode:[1 1]) (@stockQty:[(0 +inf]) ) (@storeLocation:[-73.968285 40.785091 50 mi]) ) (@productDisplayName:\'puma\') )"\n          "LOAD" "6" "@storeId" "@storeName" "@storeLocation" "@productId" "@productDisplayName" "@stockQty"\n          "APPLY" "geodistance(@storeLocation, -73.968285, 40.785091)/1609"\n          "AS" "distInMiles"\n          "SORTBY" "1" "@distInMiles"\n          "LIMIT" "0" "100"\n    */\n\n    storeProducts = <IStoreInventory[]>aggregator.results;\n\n    if (!storeProducts.length) {\n      // throw `Product not found with in ${radiusInMiles}mi range!`;\n    }\n    else {\n\n     // (4) --- Result Processing\n      storeProducts.forEach((storeProduct) => {\n        if (storeProduct?.productId && !uniqueProductIds[storeProduct.productId]) {\n          uniqueProductIds[storeProduct.productId] = true;\n\n          if (typeof storeProduct.storeLocation == "string") {\n            const location = storeProduct.storeLocation.split(",");\n            storeProduct.storeLocation = {\n              longitude: Number(location[0]),\n              latitude: Number(location[1]),\n            }\n          }\n\n          trimmedStoreProducts.push(storeProduct)\n        }\n      });\n    }\n  }\n  else {\n    throw "Mandatory fields like userLocation latitude / longitude missing !"\n  }\n\n  return {\n    storeProducts: trimmedStoreProducts,\n    productIds: Object.keys(uniqueProductIds)\n  };\n};\n\n')),(0,i.kt)("p",null,"The implementation demonstrates a practical use case for Redis's Geo Location search capabilities, showcasing how to perform proximity searches combined with other filtering criteria (like product name) and present the results in a user-friendly format."),(0,i.kt)("h3",{id:"front-end"},"Front end"),(0,i.kt)("p",null,"Make sure to select ",(0,i.kt)("inlineCode",{parentName:"p"},"Geo location search")," in settings page to enable the feature."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"settings",src:o(98306).Z,width:"1564",height:"1056"})),(0,i.kt)("p",null,'Within the dashboard, users have the option to select a random zip code and search for products (say titled "puma"). The search results are comprehensively displayed, including essential details such as the product name, available stock quantity, the name of the store, and the distance of the store from the user\'s selected location.'),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"geo-dashboard.",src:o(767).Z,width:"1920",height:"903"})),(0,i.kt)("h2",{id:"ready-to-use-redis-for-geo-location-search"},"Ready to use Redis for Geo Location search?"),(0,i.kt)("p",null,"Redis's Geo Location search capabilities offer a powerful and efficient way to perform proximity-based queries and analyses."),(0,i.kt)("p",null,"By leveraging Redis's in-memory data store and specialized geo commands, developers can build scalable, high-performance applications that respond quickly to location-based queries. The integration with the JavaScript ecosystem further simplifies the development process, enabling seamless application development and deployment."),(0,i.kt)("h3",{id:"references"},"References"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://www.youtube.com/c/Redisinc"},"Redis YouTube channel")),(0,i.kt)("li",{parentName:"ul"},"Clients like ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/redis/node-redis"},"Node Redis")," and ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/redis/redis-om-node"},"Redis om Node")," help you to use Redis in Node.js applications."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://redis.com/redis-enterprise/redis-insight/"},"RedisInsight")," : To view your Redis data or to play with raw Redis commands in the workbench"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://redis.com/try-free/"},"Try Redis Cloud for free"))))}g.isMDXComponent=!0},36773:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>p,frontMatter:()=>r,metadata:()=>s,toc:()=>d});var n=o(87462),i=(o(67294),o(3905));const r={},a=void 0,s={unversionedId:"howtos/solutions/microservices/common-data/microservices-arch",id:"howtos/solutions/microservices/common-data/microservices-arch",title:"microservices-arch",description:"Lets take a look at the architecture of the demo application:",source:"@site/docs/howtos/solutions/microservices/common-data/microservices-arch.mdx",sourceDirName:"howtos/solutions/microservices/common-data",slug:"/howtos/solutions/microservices/common-data/microservices-arch",permalink:"/howtos/solutions/microservices/common-data/microservices-arch",draft:!1,editUrl:"https://github.com/redis-developer/redis-developer/edit/master/docs/howtos/solutions/microservices/common-data/microservices-arch.mdx",tags:[],version:"current",lastUpdatedAt:1702551239,formattedLastUpdatedAt:"Dec 14, 2023",frontMatter:{}},c={},d=[],l={toc:d};function p(e){let{components:t,...o}=e;return(0,i.kt)("wrapper",(0,n.Z)({},l,o,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"Lets take a look at the architecture of the demo application:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"products service"),": handles querying products from the database and returning them to the frontend"),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"orders service"),": handles validating and creating orders"),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"order history service"),": handles querying a customer's order history"),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"payments service"),": handles processing orders for payment"),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"api gateway"),": unifies the services under a single endpoint"),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"mongodb/ postgresql"),": serves as the write-optimized database for storing orders, order history, products, etc.")),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"You don't need to use MongoDB/ Postgresql as your write-optimized database in the demo application; you can use other ",(0,i.kt)("u",null,(0,i.kt)("a",{parentName:"p",href:"https://www.prisma.io/docs/reference/database-reference/supported-databases"},"prisma supported databases"))," as well. This is just an example.")))}p.isMDXComponent=!0},93959:(e,t,o)=>{o.d(t,{Z:()=>n});const n=o.p+"assets/images/01-dashboard-geo-search-d8198bef781812bdef203b1e96884f8c.png"},4746:(e,t,o)=>{o.d(t,{Z:()=>n});const n=o.p+"assets/images/01-dashboard-eaf5461ae9e63c97bf3bcdb7085976c0.png"},6424:(e,t,o)=>{o.d(t,{Z:()=>n});const n=o.p+"assets/images/02-cart-a68efee93e1dc1984c63409e215e409d.png"},21494:(e,t,o)=>{o.d(t,{Z:()=>n});const n=o.p+"assets/images/05-order-history-66ed99ccc2662d6da70de42fcb54f1ec.png"},33643:(e,t,o)=>{o.d(t,{Z:()=>n});const n=o.p+"assets/images/06-admin-charts-5ae00e6182be0b4ada06049f5d18d0aa.png"},34959:(e,t,o)=>{o.d(t,{Z:()=>n});const n=o.p+"assets/images/07-admin-top-trending-a15bf705d2226f6e2582b4fe35bd86ae.png"},34514:(e,t,o)=>{o.d(t,{Z:()=>n});const n=o.p+"assets/images/08-settings-64f8cade2407faa3262b149e018a4ee6.png"},67941:(e,t,o)=>{o.d(t,{Z:()=>n});const n=o.p+"assets/images/collection-products-4f13594100f78ea468237e6e833123ae.png"},94986:(e,t,o)=>{o.d(t,{Z:()=>n});const n=o.p+"assets/images/collection-store-inventory-bed87db2a8e11d8a9a92738ea9c0b3d5.png"},767:(e,t,o)=>{o.d(t,{Z:()=>n});const n=o.p+"assets/images/geo-dashboard-f70594d0a2eea2ce79df45de7f60c16a.png"},92078:(e,t,o)=>{o.d(t,{Z:()=>n});const n=o.p+"assets/images/geo-query-1-25d834545951be0246618de4417d75dd.png"},10835:(e,t,o)=>{o.d(t,{Z:()=>n});const n=o.p+"assets/images/geo-query-2-eae10b079dd941d5e922bb64bdcf4ee2.png"},59362:(e,t,o)=>{o.d(t,{Z:()=>n});const n=o.p+"assets/images/new-york-state-eb53b2ff5ced18de475a1b0de8004b12.png"},98306:(e,t,o)=>{o.d(t,{Z:()=>n});const n=o.p+"assets/images/settings-64f8cade2407faa3262b149e018a4ee6.png"}}]);